@page "/"
@using FreeWaterTips.Shared.Services
@using FreeWaterTips.Utils.Responses
@inject IFormFactor FormFactor
@inject IAzureFunctionsApiService AzureFunctionsApiService

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app running on <em>@factor</em> using <em>@platform</em>.

@if (health != null)
{
    <p>Azure Functions are @health.Status, running on @health.AzureFunctionsEndpoint with a CosmosDB on @health.CosmosDBEndpoint</p>
}
else if (isLoading)
{
    <p>Loading health status...</p>
}
else
{
    <p>Failed to load health status.</p>
}

@code {
    private string factor => FormFactor.GetFormFactor();
    private string platform => FormFactor.GetPlatform();
    private HealthResponse? health;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            health = await AzureFunctionsApiService.GetAsync<HealthResponse>("Health");
        }
        catch (Exception ex)
        {
            // Handle exception - could log it or show error message
            Console.WriteLine($"Error loading health status: {ex.Message}");
        }
        finally
        {
            isLoading = false;
        }
    }
}
